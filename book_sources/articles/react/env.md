# é‚„åœ¨ç‚ºä¸åŒåŸ·è¡Œç’°å¢ƒå¯« if else? ä½ éœ€è¦çš„æ˜¯.env

å…¬å¸çš„å‰ç«¯å°ˆæ¡ˆéœ€è¦ä¸‰å€‹åŸ·è¡Œç’°å¢ƒï¼Œåˆ†åˆ¥æ˜¯ develpoment, uat, productionï¼Œç•¶ä½ è²»ç›¡åƒè¾›è¬è‹¦å°‡å°ˆæ¡ˆåˆ†åˆ¥éƒ¨ç½²ä¸Šä¸‰å°æ©Ÿå™¨ä»¥å¾Œï¼Œç™¼ç¾éœ€è¦æ ¹æ“šåŸ·è¡Œç’°å¢ƒä¾†åˆ¤æ–· CLIENT_IDï¼Œé€™æ™‚å€™ï¼Œä½ æœƒæ€éº¼åšï¼Ÿ

æ‰ä¸€å€‹è®Šæ•¸è€Œå·²ï¼Œæˆ‘åˆ†åˆ¥åœ¨ä¸‰å°æ©Ÿå™¨ä¸Šé¢æ”¹å°±å¥½äº†ã€‚
ç„¶å¾Œä½ ç™¼ç¾ï¼Œæ¯æ¬¡ç‰ˆæœ¬æ›´æ–°çš„æ™‚å€™ä½ éƒ½è¦ç‰¹åˆ¥æ³¨æ„é€™å€‹æª”æ¡ˆï¼Œå› ç‚ºæ·±æ€• CLIENT_ID è¢«è¦†è“‹æ‰ã€‚

æ³¨æ„åˆ°äº†å—ï¼Ÿä½ åšäº†ä¸€å€‹**æ“´å±•æ€§å¾ˆå·®**çš„æ±ºå®šï¼Œå› ç‚ºå¦‚æœæœªä¾†æœ‰æ›´å¤šè®Šæ•¸éœ€è¦ä¾è³´æ–¼åŸ·è¡Œç’°å¢ƒï¼Œä½ å°±æœƒéœ€è¦é—œæ³¨æ›´å¤šæª”æ¡ˆï¼Œé€™å°æ‡¶äººå·¥ç¨‹å¸«è€Œè¨€æ˜¯ç›¸ç•¶ä¸å‹å–„çš„ã€‚

è¶æ—©ç‚ºå°ˆæ¡ˆå¼•å…¥ .env å§ï¼é€™äº›é¡å¤–å¿ƒåŠ›æ˜¯å®Œå…¨å¯ä»¥é¿å…çš„ã€‚

### é‚£éº¼è¦å¦‚ä½•æ ¹æ“šç’°å¢ƒå¼•å…¥ä¸åŒçš„.env å‘¢ï¼Ÿ

å¦‚æœä½ ä½¿ç”¨ CRA å»ºç«‹å°ˆæ¡ˆï¼Œå¯ä»¥åƒè€ƒé€™å€‹[æ–‡ä»¶](https://create-react-app.dev/docs/adding-custom-environment-variables/#what-other-env-files-can-be-used)ã€‚

> å¦‚æœä¸æ˜¯...é‚£ä½ å¯èƒ½è¦ç¨å¾®äº†è§£ä¸€ä¸‹ Webpack DefinePluginï¼Œå¤§éƒ¨åˆ†çš„ç’°å¢ƒè®Šæ•¸å¥—ä»¶éƒ½æ˜¯é å®ƒå¯¦ä½œçš„ã€‚

ç°¡å–®èªªï¼ŒCRA å°ˆæ¡ˆæœƒåœ¨ä½ åŸ·è¡ŒæŒ‡ä»¤æ™‚è‡ªå‹•åˆ¤æ–·è¦å¼•å…¥å“ªå€‹å°æ‡‰çš„.env æª” (æ¬Šé‡ç”±å¤§åˆ°å°):

- npm run start : .env.development.local, .env.local, .env.development, .env
- npm run build : .env.production.local, .env.local, .env.production, .env
- npm run test : .env.test.local, .env.test, .env(note .env.local is missing)

æ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨å°ˆæ¡ˆå…§æ–°å¢ä¸€å€‹.env.development æª”æ¡ˆ:

```
# .env.development
REACT_APP_CLIENT_ID = myLocalClientId
```

ä¸€å€‹.env.production æª”æ¡ˆ:

```
# .env.production
REACT_APP_CLIENT_ID = myProductionClientId
```

> ### æ³¨æ„ï¼šä¸€å®šè¦åŠ ä¸Š REACT_APP å‰ç¶´ CRA æ‰æœƒå°‡é€™å€‹è®Šæ•¸æ‰“åŒ…é€² process.env

ç´°å¿ƒçš„ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œé‚£ uat ç’°å¢ƒå‘¢ï¼Ÿé€™æ¨£æˆ‘å€‘åªè¨­å®šäº†å…©å€‹è®Šæ•¸ç‰ˆæœ¬å‘€ï¼Ÿ

### è‡ªè¡Œæ“´å…….env

è¦è‡ªè¡Œé‡å°éœ€æ±‚ä¾†æ“´å…… env ç¨®é¡ï¼Œæˆ‘èªç‚ºæœ€ç°¡å–®çš„æ–¹å¼æ˜¯ä½¿ç”¨ [dotenv-cli
](https://www.npmjs.com/package/dotenv-cli) å¥—ä»¶ã€‚

> ç•¶ç„¶æœ‰å¿—è€…ä¹Ÿå¯ä»¥ç›´æ¥é€é`react-app-rewired`å¥—ä»¶ç·¨è¼¯`config-overrides`æª”æ¡ˆï¼Œè‡ªè¡Œç·¨å¯« webpack è¦å‰‡ã€‚

é€™é‚Šæˆ‘å€‘çš„éœ€æ±‚æ˜¯æ–°å¢ä¸€å€‹ uat çš„ç’°å¢ƒè®Šæ•¸:

```
// package.json
"scripts": {
  "start": "dotenv -e .env.development react-app-rewired start",
  "build:uat": "dotenv -e .env.uat react-app-rewired build",
  "build": "dotenv -e .env.production react-app-rewired build",
  "test": "react-app-rewired test",
}
```

```
# .env.uat
REACT_APP_CLIENT_ID = myUatClientId
```

å¦‚æ­¤ä¸€ä¾†ä¾¿å¯ä»¥æ‡‰å°å¤šç¨®ç’°å¢ƒè®Šæ•¸çš„æƒ…æ³äº†ã€‚<br>
å¦‚æœä½ æƒ³åœ¨é–‹ç™¼è€…æ¨¡å¼ä¸‹æ¨¡æ“¬ç·šä¸Šç’°å¢ƒï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŠ ä¸Š:<br>

```
"start:prod": "dotenv -e .env.production react-app-rewired start",
```

ä¸éè¦æ³¨æ„çš„é»æ˜¯ï¼Œæ­¤æƒ…æ³ä¸‹ webpack é è¨­çš„ NODE_ENV é‚„æ˜¯ developmentï¼Œå¦‚æœç¨‹å¼å…§æœ‰é€²è¡Œåˆ¤æ–·çš„è¦ç‰¹åˆ¥å°å¿ƒã€‚

æœ‰äº† `dotenv-cli` å¯ä»¥è®“æˆ‘å€‘çš„ç’°å¢ƒè®Šæ•¸æ“´å……æ›´æ–¹ä¾¿ï¼Œæ‡‰å°è¤‡é›œçš„å°ˆæ¡ˆéœ€æ±‚ä¹Ÿå¯ä»¥ä»»æ„æ··æ­ï¼Œå¯¦åœ¨æ˜¯å¾ˆæ–¹ä¾¿ï¼

### æ¥ä¸‹ä¾†...?

å¦‚æœæ˜¯æ‰‹å‹•éƒ¨ç½²ï¼Œä½ ç¾åœ¨å·²ç¶“å¯ä»¥é€éåœ¨ä¸‰å°æ©Ÿå™¨ä¸‹ä¸åŒçš„æŒ‡ä»¤ä¾†è®“ç¨‹å¼å¼•å…¥ä¸åŒçš„ç’°å¢ƒè®Šæ•¸äº†ã€‚<br>

ä½†æˆ‘èªç‚ºè¦å®Œå…¨è§£æ”¾é›™æ‰‹ï¼Œç•¶ä¸€å€‹æ‡¶äººå·¥ç¨‹å¸« ğŸ˜ï¼Œéœ€è¦æ­é… CI/CD æ‰ç®—æ˜¯å¤§åŠŸå‘Šæˆï¼Œé€™éƒ¨åˆ†å°±æœŸå¾…æˆ‘å¾ŒçºŒçš„æ–‡ç« å§ï¼
